<!DOCTYPE html>
<meta name="Touching" content="Demonstrates AABB collision detection in Game.js.">

<title>
    Touching with AABB collision detection
</title>
<body bgColor="black">

</body>
<p id="canvas"></p>
<p id="FPS" style="color: white"></p>

<script src="gamejs.js"></script>
<script>

// TODO: Made the parent invisible

//GameJS.config.flags.useQTrees = false

click = false

Game = GameJS.init({
    "game": {
        "assets": {
            "imgs": [
                {
                    "src": "assets/imgs/orange.png",
                    "id": "orange"
                },
            ],
            "snds": []
        },
        "sprites": [
            {
                "x": 100,
                "y": 225,
                "scale": 10,
                "img": "orange",
                "id": "orange",
                "alpha": 0.5,
                "vars": {
                    "IDWas": null
                },
                "scripts": {
                    "init": [
                        {
                            "stateToRun": "Game",
                            "code": function(gameRef, me) {
                                me.visible = false

                                canvas = document.createElement("canvas")
                                ctx = canvas.getContext("2d")
                                document.body.appendChild(canvas)
                                Game.internal.collision.qtree.methods.debugDisplay(canvas, ctx, Game)

                                var i = 0
                                while (i < 2) {
                                    var y = ((i + 15) + 1) * 15

                                    // Generate left and right side sprites
                                    for (x of [250,700]) {
                                        // Left or right?
                                        var direction = (x < (Game.width / 2)) ? 1 : -1
                                        for (var c=0; c < 5; c++) {
                                            GameJS.methods.cloneSprite(me.id, {
                                                "x": x,
                                                "y": y,
                                                "visible": true,
                                                "vars": {
                                                    "direction": direction
                                                }
                                            })
                                            x = x + (30 * direction)
                                        }
                                    }
                                    i++
                                }
                                // Put one in the middle of the screen
                                GameJS.methods.cloneSprite(me.id, {
                                    "x": Game.width / 2,
                                    "y": 200,
                                    "visible": true,
                                    "vars": {
                                        "direction": 0
                                    }
                                })
                            }
                        }
                    ],
                    "main": [
                        {
                            "stateToRun": "Game",
                            "code": function(gameRef, me) {
                                Game.internal.collision.qtree.methods.debugDisplay(canvas, ctx, Game)
                            }
                        }
                    ]
                },
                "clones": {
                    "scripts": {
                        "init": [
                            function(gameref, me) {
                                me.width = me.width / 20
                                me.height = me.height / 20
                            }
                        ],
                        "main": [
                            function(gameRef, me) {
                                var speed = 1
                                if (GameJS.methods.AABBTouching("orange")) {
                                    //me.x = me.x - (speed * me.vars.direction)
                                    //if (! GameJS.methods.AABBTouching("orange")) {
                                    //    me.x = me.x + (speed * me.vars.direction)
                                    //}
                                }
                                else {
                                    me.x = me.x + (speed * me.vars.direction)
                                }
                                if (Game.mouseDown) {
                                    if (! click) {
                                        if (GameJS.methods.touchingMouse()) {
                                            click = true
                                            console.log(me)
                                        }
                                    }
                                }
                                else {
                                    click = false
                                }
                            }
                        ]
                    }
                }
            }
        ],
        "scripts": {}
    },
    "config": {
        "state": "Game",
        "display": {
            "fillScreen": true
        }
    },
    "ID": "Game",
    "width": 800,
    "height": 450,
    "htmlElementID": "canvas"
})

clones = 0
setInterval(function() {
    document.getElementById("FPS").innerHTML = Math.round(Game.currentFPS) + "<br>" + clones
}, 30)

</script>
