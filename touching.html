<!DOCTYPE html>
<meta name="Touching" content="Demonstrates AABB collision detection in Beginning.js.">

<title>
    Touching with AABB collision detection
</title>
<body bgColor="black">

</body>
<p id="canvas"></p>
<p id="FPS" style="color: white"></p>

<script src="beginningJS.js"></script>
<script>

// TODO: Made the parent invisible

click = false

Game = BeginningJS.init({
    "game": {
        "assets": {
            "imgs": [
                {
                    "src": "assets/imgs/orange.png",
                    "id": "orange"
                },
            ],
            "snds": []
        },
        "sprites": [
            {
                "x": 100,
                "y": 500,
                "scale": 0.5,
                "img": "orange",
                "id": "orange",
                "alpha": 0.5,
                "vars": {
                    "IDWas": null
                },
                "scripts": {
                    "init": [
                        {
                            "stateToRun": "Game",
                            "code": function(gameRef, me) {
                                me.visible = false

                                canvas = document.createElement("canvas")
                                ctx = canvas.getContext("2d")
                                document.body.appendChild(canvas)
                                var spacing = 15

                                var i = 0
                                while (i < 20) {
                                    var y = (i * spacing) + 50

                                    // Generate left and right side sprites
                                    for (x of [0,800]) {
                                        // Left or right?
                                        var direction = (x < (Game.width / 2)) ? 1 : -1
                                        for (var c=0; c < 20; c++) {
                                            BeginningJS.methods.cloneSprite(me.id, {
                                                "x": x,
                                                "y": y,
                                                "visible": true,
                                                "vars": {
                                                    "direction": direction
                                                }
                                            })
                                            x = x + (spacing * direction)
                                        }
                                    }
                                    i++
                                }
                                // Put one in the middle of the screen
                                BeginningJS.methods.cloneSprite(me.id, {
                                    "x": Game.width / 2,
                                    "y": 200,
                                    "visible": true,
                                    "vars": {
                                        "direction": 0
                                    }
                                })
                            }
                        }
                    ],
                    "main": [
                        {
                            "stateToRun": "Game",
                            "code": function(gameRef, me) {
                                
                            }
                        }
                    ]
                },
                "clones": {
                    "scripts": {
                        "init": [],
                        "main": [
                            function(gameRef, me) {
                                var speed = 1
                                if (BeginningJS.methods.AABBTouching("orange")) {
                                    //me.x = me.x - (speed * me.vars.direction)
                                    //if (! BeginningJS.methods.AABBTouching("orange")) {
                                    //    me.x = me.x + (speed * me.vars.direction)
                                    //}
                                }
                                else {
                                    me.x = me.x + (speed * me.vars.direction)
                                }
                                if (Game.mouseDown) {
                                    if (! click) {
                                        if (BeginningJS.methods.touchingMouse()) {
                                            click = true
                                            console.log(me)
                                        }
                                    }
                                }
                                else {
                                    click = false
                                }
                            }
                        ]
                    }
                }
            },
            {
                "x": 400,
                "y": 225,
                "width": 800,
                "height": 450,
                "type": "canvas",
                "id": "qtreeIndex",
                "vars": {
                    "IDWas": null
                },
                "scripts": {
                    "init": [
                        {
                            "stateToRun": "Game",
                            "code": function(gameRef, me) {

                            }
                        }
                    ],
                    "main": [
                        {
                            "stateToRun": "Game",
                            "code": function(gameRef, me) {
                                me.ctx.clearRect(0, 0, me.canvas.width, me.canvas.height)
                                me.ctx.drawImage(canvas, 0, 0, me.canvas.width, me.canvas.height)
                            }
                        }
                    ]
                },
                "clones": {}
            }
        ],
        "scripts": {}
    },
    "config": {
        "state": "Game",
        "display": {
            "fillScreen": true
        }
    },
    "ID": "Game",
    "width": 800,
    "height": 450,
    "htmlElementID": "canvas"
})

clones = 0
setInterval(function() {
    document.getElementById("FPS").innerHTML = Math.round(Game.currentFPS) + "<br>" + clones
}, 30)

</script>
